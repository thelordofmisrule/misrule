<!-- layouts/partials/comments.html -->
<section id="isso-thread"></section>

<!-- Isso client -->
<script
  data-isso="https://comments.misrule.me/"
  src="https://comments.misrule.me/js/embed.min.js">
</script>

<!-- Fix Isso styling -->
<style>
/* Keep original thread width */
#isso-thread {
  max-width: 100%;
}

/* Hide ALL optional text */
#isso-thread .optional {
  display: none !important;
}

/* Red asterisk for required fields */
#isso-thread label[for="isso-postbox-author"]:after,
#isso-thread label[for="isso-postbox-email"]:after {
  content: " *";
  color: #c00;
}

/* Make auth fields and buttons align horizontally with more spacing */
#isso-thread .isso-auth-section {
  display: inline-block !important;
  margin-right: 2.5em;
}

#isso-thread .isso-auth-section > div {
  display: inline-block;
  margin-right: 2.5em;
}

#isso-thread .isso-post-action {
  display: inline-block !important;
}

#isso-thread .isso-post-action > * {
  margin-right: 1em;
}

/* Ensure textarea stays full width */
#isso-thread .isso-textarea-wrapper textarea {
  width: 100%;
  box-sizing: border-box;
}
</style>

<!-- Remove any remaining (optional) text -->
<script>
function removeOptionalText() {
  // Get all elements in isso thread
  var elements = document.querySelectorAll('#isso-thread *');
  
  elements.forEach(function(el) {
    // Check all child nodes
    for (var i = 0; i < el.childNodes.length; i++) {
      var node = el.childNodes[i];
      // If it's a text node containing (optional)
      if (node.nodeType === 3 && node.textContent.includes('(optional)')) {
        node.textContent = node.textContent.replace(/\s*\(optional\)\s*/g, '');
      }
    }
  });
  
  // Also check for any spans with optional class
  var optionalSpans = document.querySelectorAll('#isso-thread .optional');
  optionalSpans.forEach(function(span) {
    span.style.display = 'none';
  });
  
  // Change email placeholder
  var emailInput = document.querySelector('#isso-thread input[type="email"]');
  if (emailInput) {
    emailInput.placeholder = 'jdoe@example.com';
  }
}

// Run when page loads
window.addEventListener('load', function() {
  // Run multiple times to catch dynamically added content
  setTimeout(removeOptionalText, 500);
  setTimeout(removeOptionalText, 1000);
  setTimeout(removeOptionalText, 1500);
  setTimeout(removeOptionalText, 2000);
  
  // Also watch for changes
  var observer = new MutationObserver(function(mutations) {
    removeOptionalText();
  });
  
  var issoThread = document.getElementById('isso-thread');
  if (issoThread) {
    observer.observe(issoThread, { childList: true, subtree: true });
  }
});
</script>