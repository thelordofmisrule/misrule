<!-- layouts/partials/comments.html -->
<section id="isso-thread"></section>

<!-- Isso client -->
<script
  data-isso="https://comments.misrule.me/"
  src="https://comments.misrule.me/js/embed.min.js">
</script>

<!-- Fix Isso styling -->
<style>
/* Keep original thread width */
#isso-thread {
  max-width: 100%;
}

/* Hide ALL optional text */
#isso-thread .optional {
  display: none !important;
}

/* Red asterisk for required fields */
#isso-thread label[for="isso-postbox-author"]:after,
#isso-thread label[for="isso-postbox-email"]:after {
  content: " *";
  color: #c00;
}

/* Make auth fields and buttons align horizontally with more spacing */
#isso-thread .isso-auth-section {
  display: inline-block !important;
  margin-right: 2em;
}

#isso-thread .isso-auth-section > div {
  display: inline-block;
  margin-right: 2em;
}

#isso-thread .isso-post-action {
  display: inline-block !important;
}

#isso-thread .isso-post-action > * {
  margin-right: 1em;
}

/* Ensure textarea stays full width */
#isso-thread .isso-textarea-wrapper textarea {
  width: 100%;
  box-sizing: border-box;
}
</style>

<!-- Remove any remaining (optional) text -->
<script>
window.addEventListener('load', function() {
  // Wait for Isso to fully render
  setTimeout(function() {
    // Get all text in the isso thread
    var walker = document.createTreeWalker(
      document.getElementById('isso-thread'),
      NodeFilter.SHOW_TEXT,
      {
        acceptNode: function(node) {
          return node.nodeValue.includes('(optional)') ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        }
      }
    );
    
    var node;
    var nodes = [];
    while (node = walker.nextNode()) {
      nodes.push(node);
    }
    
    // Remove (optional) from all text nodes
    nodes.forEach(function(node) {
      node.nodeValue = node.nodeValue.replace(/\s*\(optional\)\s*/g, '');
    });
  }, 2000);  // Increased from 1000 to 2000ms
});
</script>